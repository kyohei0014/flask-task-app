<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>タスク管理</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
.task { padding: 10px; border: 1px solid #ccc; margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center; }
.due-date { text-align: right; font-size: 0.9em; color: #555; flex-shrink: 0; margin-left: 10px; }
button { padding: 5px 10px; border: none; cursor: pointer; border-radius: 4px; }
.add-btn { background-color: #007BFF; color: white; }
.edit-btn { background-color: #28A745; color: white; }
.complete-btn { background-color: #FFC107; color: white; }
.delete-btn { background-color: #DC3545; color: white; }
hr.divider { border: 1px solid #999; margin: 20px 0; }
</style>
</head>
<body>

<h1>タスク管理</h1>

<!-- タスク追加 / 編集フォーム -->
<form method="POST" action="{{ editing_task and url_for('update', task_id=editing_task.id) or url_for('add') }}">
  <input type="text" name="title" placeholder="タスク名" required value="{{ editing_task and editing_task.title or '' }}">
  <input type="date" name="due_date" value="{{ editing_task and editing_task.due_date or '' }}">
  <button type="submit" class="{{ editing_task and 'edit-btn' or 'add-btn' }}">
    {{ editing_task and '更新' or '追加' }}
  </button>
</form>

<h2>未完了タスク</h2>
{% for task in tasks %}
<div class="task">
  <span>{{ task.title }}</span>
  <span class="due-date">{{ task.due_date }}</span>
  <span>
    <form method="POST" action="{{ url_for('complete', task_id=task.id) }}" style="display:inline;">
      <button type="submit" class="complete-btn">完了</button>
    </form>
    <form method="GET" action="{{ url_for('edit', task_id=task.id) }}" style="display:inline;">
      <button type="submit" class="edit-btn">編集</button>
    </form>
    <form method="POST" action="{{ url_for('delete', task_id=task.id) }}" style="display:inline;">
      <button type="submit" class="delete-btn">削除</button>
    </form>
  </span>
</div>
{% endfor %}

<hr class="divider">

<h2>完了済みタスク</h2>
{% for task in completed_tasks %}
<div class="task">
  <span>{{ task.title }}</span>
  <span class="due-date">{{ task.due_date }}</span>
  <span>
    <form method="POST" action="{{ url_for('complete', task_id=task.id) }}" style="display:inline;">
      <button type="submit" class="complete-btn">未完了に戻す</button>
    </form>
    <form method="POST" action="{{ url_for('delete', task_id=task.id) }}" style="display:inline;">
      <button type="submit" class="delete-btn">削除</button>
    </form>
  </span>
</div>
{% endfor %}

</body>
</html>
